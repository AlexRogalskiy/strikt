apply plugin: "announce"

announce {
  username = "stri_kt"
  password = System.getenv("TWITTER_PASSWORD")
}

task("final").doLast {
  def tag = System.getenv("CIRCLE_TAG")
  if (!tag) throw new IllegalStateException("Should not be tweeting without a release tag!")
  def releaseName = new groovy.json.JsonSlurper()
    .parseText("https://api.github.com/repos/robfletcher/strikt/releases/tags/v0.7.1?access_token=${System.getenv("GITHUB_OAUTH_TOKEN")}".toURL().text)
    .name
  announce.announce("Strikt ${tag} ${releaseName} is available. https://strikt.io", "twitter")
}
